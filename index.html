<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef Stable 2.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white p-4">
    <div class="max-w-md mx-auto">
        <h1 class="text-3xl font-black text-center mb-6 text-blue-400">üë®‚Äçüç≥ ‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏ä‡∏ü V.2.5</h1>
        
        <div id="keyBox" class="bg-slate-800 p-6 rounded-3xl border-2 border-blue-500 shadow-xl">
            <h2 class="text-lg font-bold mb-4">üîë ‡∏ß‡∏≤‡∏á API Key ‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ:</h2>
            <input type="text" id="newKey" placeholder="AIzaSy..." class="w-full p-4 rounded-xl bg-slate-700 text-white mb-4 border border-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-400">
            <button onclick="testKey()" class="w-full bg-blue-600 p-4 rounded-xl font-bold text-xl active:scale-95 transition-all">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ß!</button>
            <p id="errorMsg" class="mt-4 text-red-400 text-sm hidden text-center"></p>
        </div>

        <div id="mainApp" class="hidden">
            <div class="relative mb-6">
                <video id="video" autoplay playsinline muted class="w-full rounded-2xl border-4 border-slate-700"></video>
                <canvas id="canvas" class="hidden"></canvas>
                <button onclick="captureAndScan()" id="snapBtn" class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-red-600 w-20 h-20 rounded-full border-4 border-slate-900 shadow-2xl flex items-center justify-center active:scale-95 transition-all">
                    <span class="text-white font-black">SCAN</span>
                </button>
            </div>
            <div id="status" class="text-center text-xl mt-8 mb-4 text-yellow-400 font-bold h-10 italic">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô...</div>
            <div id="orderQueue" class="space-y-4 pb-24 text-2xl font-bold"></div>
        </div>
    </div>

    <script>
        let FINAL_KEY = "";
        const MODEL = "gemini-2.5-flash";

        async function testKey() {
            const key = document.getElementById('newKey').value.trim();
            const errorMsg = document.getElementById('errorMsg');
            
            if(!key) return alert("‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏ü!");

            errorMsg.innerText = "üåÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå...";
            errorMsg.classList.remove('hidden', 'text-red-400');
            errorMsg.classList.add('text-blue-400');

            try {
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÑ‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡∏µ‡∏¢‡πå‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏´‡∏°
                const res = await fetch(`https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "hi" }] }] })
                });
                const data = await res.json();

                if (data.error) throw new Error(data.error.message);

                // ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô
                FINAL_KEY = key;
                document.getElementById('keyBox').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                setupCamera();
            } catch (err) {
                errorMsg.innerText = "‚ùå ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err.message;
                errorMsg.classList.add('text-red-400');
            }
        }

        async function setupCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            document.getElementById('video').srcObject = stream;
        }

        async function captureAndScan() {
            const status = document.getElementById('status');
            const canvas = document.getElementById('canvas');
            const video = document.getElementById('video');
            
            status.innerText = "üåÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";
            
            const context = canvas.getContext('2d');
            canvas.width = 800;
            canvas.height = video.videoHeight * (800 / video.videoWidth);
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const base64Data = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${FINAL_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [
                            { text: "‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏ï‡πä‡∏∞‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏±‡πâ‡∏ô‡πÜ" },
                            { inline_data: { mime_type: "image/jpeg", data: base64Data } }
                        ]}]
                    })
                });
                const data = await response.json();
                const result = data.candidates[0].content.parts[0].text;
                document.getElementById('orderQueue').innerHTML = `<div class="bg-slate-800 p-4 rounded-xl border-l-8 border-green-500 mb-2">${result.replace(/\n/g, '<br>')}</div>` + document.getElementById('orderQueue').innerHTML;
                status.innerText = "‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
            } catch (e) { status.innerText = "‚ùå ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏£‡∏±‡∏ö"; }
        }
    </script>
</body>
</html>
