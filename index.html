<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef Pro Dashboard V2.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;900&display=swap');
        body { font-family: 'Prompt', sans-serif; background-color: #020617; }
        .bill-card { 
            background: #1e293b;
            border-left: 12px solid #3b82f6;
            animation: slideIn 0.3s ease-out;
        }
        .new-order { animation: pulseBorder 2s infinite; }
        @keyframes pulseBorder {
            0% { border-left-color: #3b82f6; }
            50% { border-left-color: #fbbf24; }
            100% { border-left-color: #3b82f6; }
        }
        @keyframes slideIn {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="text-white p-4">
    <div class="max-w-3xl mx-auto">
        <div class="flex justify-between items-center mb-6 bg-slate-800 p-4 rounded-2xl shadow-lg border-b-4 border-blue-500">
            <div>
                <h1 class="text-3xl font-black text-blue-400">COMMAND CENTER</h1>
                <p id="status" class="text-green-400 font-bold italic">‚óè SYSTEM ONLINE</p>
            </div>
            <div class="text-right">
                <button onclick="clearSavedKey()" class="text-xs text-slate-500 underline">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Key</button>
            </div>
        </div>

        <div class="relative mb-8 group">
            <video id="video" autoplay playsinline muted class="w-full rounded-3xl border-4 border-slate-700 shadow-2xl transition-all group-hover:border-blue-500"></video>
            <canvas id="canvas" class="hidden"></canvas>
            <button onclick="captureAndScan()" id="snapBtn" class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-blue-600 hover:bg-blue-500 w-28 h-28 rounded-full border-8 border-slate-900 shadow-2xl flex items-center justify-center active:scale-90 transition-all">
                <span class="text-white font-black text-xl">SCAN</span>
            </button>
        </div>

        <div class="mt-12 space-y-6">
            <div class="flex justify-between items-end border-b-2 border-slate-700 pb-2">
                <h2 class="text-2xl font-black text-slate-400 uppercase">Current Orders</h2>
                <button onclick="clearOrders()" class="text-red-500 font-bold hover:text-red-400">CLEAR ALL</button>
            </div>
            
            <div id="orderQueue" class="space-y-4 pb-32">
                <div class="text-center text-slate-600 py-10 italic text-xl">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤...</div>
            </div>
        </div>
    </div>

   <script>
    let API_KEY = localStorage.getItem('chef_api_key') || "";
    const MODEL = "gemini-2.5-flash";

    async function setupCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment", width: { ideal: 1280 } } 
            });
            document.getElementById('video').srcObject = stream;
        } catch (err) { alert("Camera error: " + err.message); }
    }

    async function captureAndScan() {
        if(!API_KEY) {
            const key = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡∏ü‡∏Ñ‡∏£‡∏±‡∏ö:");
            if(key) { localStorage.setItem('chef_api_key', key); location.reload(); }
            return;
        }

        const status = document.getElementById('status');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');

        status.innerText = "üåÄ ANALYZING...";
        status.className = "text-yellow-400 font-bold italic animate-pulse";

        const context = canvas.getContext('2d');
        canvas.width = 1024;
        canvas.height = video.videoHeight * (1024 / video.videoWidth);
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const base64Data = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [
                        { text: "‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•‡∏ô‡∏µ‡πâ: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞, ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ï‡πà‡∏≠‡πÜ‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ () ‡πÅ‡∏•‡∏∞ + ‡πÇ‡∏î‡∏¢‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î** ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ö‡∏¥‡∏•‡∏ï‡∏≠‡∏ö IGNORE" },
                        { inline_data: { mime_type: "image/jpeg", data: base64Data } }
                    ]}]
                })
            });
            const data = await response.json();
            const result = data.candidates[0].content.parts[0].text.trim();

            if (result !== "IGNORE") {
                // ‡∏ï‡∏±‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ () ‡πÅ‡∏•‡∏∞ + ‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢ JavaScript ‡∏≠‡∏µ‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå
                const cleanResult = result.replace(/[()+]/g, '');
                addOrderToUI(cleanResult);
                status.innerText = "‚óè SYSTEM ONLINE";
                status.className = "text-green-400 font-bold italic";
            } else {
                status.innerText = "‚ö†Ô∏è NOT A BILL";
                status.className = "text-red-400 font-bold italic";
            }
        } catch (e) { 
            status.innerText = "‚ùå ERROR: TRY AGAIN";
            status.className = "text-red-500 font-bold";
        }
    }

    function addOrderToUI(text) {
        const queue = document.getElementById('orderQueue');
        if (queue.innerText.includes("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤")) queue.innerHTML = "";

        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const lines = text.split('\n');
        const table = lines[0];
        const items = lines.slice(1).join('<br>');

        const card = document.createElement('div');
        card.className = "bill-card p-6 rounded-2xl shadow-2xl relative new-order mb-4";
        card.innerHTML = `
            <div class="flex justify-between items-start">
                <div class="text-4xl font-black text-yellow-400 mb-2 uppercase">${table}</div>
                <div class="text-slate-500 font-bold">${time}</div>
            </div>
            <div class="text-3xl font-bold text-white leading-snug">${items}</div>
            <button onclick="this.parentElement.remove()" class="absolute -top-2 -right-2 bg-red-500 w-10 h-10 rounded-full flex items-center justify-center font-bold shadow-lg">‚úï</button>
        `;
        queue.prepend(card);
        
        setTimeout(() => card.classList.remove('new-order'), 10000);
    }

    function clearOrders() { if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) document.getElementById('orderQueue').innerHTML = ""; }
    function clearSavedKey() { localStorage.removeItem('chef_api_key'); location.reload(); }

    setupCamera();
</script>
</body>
</html>
