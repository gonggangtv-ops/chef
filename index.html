<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef Horizontal Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;900&display=swap');
        body { font-family: 'Prompt', sans-serif; background-color: #020617; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ö‡∏¥‡∏•‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
        .bill-card { 
            min-width: 250px;
            max-width: 300px;
            background: #1e293b;
            border-top: 10px solid #3b82f6; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏≤‡πÄ‡∏ô‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô */
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* ‡∏ã‡πà‡∏≠‡∏ô Scrollbar ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-white p-4">
    <div class="max-w-full mx-auto">
        <div class="flex justify-between items-center mb-4 bg-slate-800 p-3 rounded-xl border-b-2 border-blue-500">
            <h1 class="text-xl font-black text-blue-400 uppercase">Horizontal Kitchen View</h1>
            <p id="status" class="text-green-400 text-sm font-bold italic">‚óè READY</p>
        </div>

        <div class="flex justify-center mb-6">
            <div class="relative w-full max-w-md">
                <video id="video" autoplay playsinline muted class="w-full rounded-2xl border-2 border-slate-700"></video>
                <canvas id="canvas" class="hidden"></canvas>
                <button onclick="captureAndScan()" id="snapBtn" class="absolute -bottom-5 left-1/2 transform -translate-x-1/2 bg-blue-600 w-16 h-16 rounded-full border-4 border-slate-900 shadow-xl flex items-center justify-center active:scale-90 transition-all">
                    <span class="text-white font-black text-xs">SCAN</span>
                </button>
            </div>
        </div>

        <div class="mt-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold text-slate-400">ACTIVE BILLS (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏™‡πÅ‡∏Å‡∏ô)</h2>
                <button onclick="clearOrders()" class="text-red-500 text-sm font-bold">CLEAR ALL</button>
            </div>
            
            <div id="orderQueue" class="flex flex-wrap gap-4 pb-20 justify-start">
                <div class="text-slate-600 italic">‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏¥‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...</div>
            </div>
        </div>
    </div>

    <script>
        let API_KEY = localStorage.getItem('chef_api_key') || "";
        const MODEL = "gemini-2.5-flash";

        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } 
                });
                document.getElementById('video').srcObject = stream;
            } catch (err) { alert("Camera error"); }
        }

        async function captureAndScan() {
            if(!API_KEY) {
                const key = prompt("‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡∏ü:");
                if(key) { localStorage.setItem('chef_api_key', key); location.reload(); }
                return;
            }

            const status = document.getElementById('status');
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');

            status.innerText = "üåÄ SCANNING...";

            const context = canvas.getContext('2d');
            canvas.width = 1024;
            canvas.height = video.videoHeight * (1024 / video.videoWidth);
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const base64Data = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [
                            { text: "‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏•‡∏ô‡∏µ‡πâ: ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞, ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ï‡πà‡∏≠‡πÜ‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏¢‡∏∏‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏ô‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡∏°‡∏≤‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏°‡∏ô‡∏π‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ () ‡πÅ‡∏•‡∏∞ + ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ö‡∏¥‡∏•‡∏ï‡∏≠‡∏ö IGNORE" },
                            { inline_data: { mime_type: "image/jpeg", data: base64Data } }
                        ]}]
                    })
                });
                const data = await response.json();
                const result = data.candidates[0].content.parts[0].text.trim();

                if (result !== "IGNORE") {
                    addOrderToUI(result.replace(/[()+]/g, ' '));
                    status.innerText = "‚óè READY";
                } else {
                    status.innerText = "‚ö†Ô∏è TRY AGAIN";
                }
            } catch (e) { 
                status.innerText = "‚ùå ERROR";
            }
        }

        function addOrderToUI(text) {
            const queue = document.getElementById('orderQueue');
            if (queue.innerText.includes("‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏¥‡∏•")) queue.innerHTML = "";

            const lines = text.split('\n').filter(l => l.trim() !== "");
            const table = lines[0];
            const items = lines.slice(1).join('<br>');

            const card = document.createElement('div');
            card.className = "bill-card p-4 rounded-xl shadow-lg relative flex-none";
            card.innerHTML = `
                <div class="text-3xl font-black text-yellow-400 border-b border-slate-600 mb-2 pb-1">${table}</div>
                <div class="text-xl font-bold text-white leading-tight min-h-[60px]">${items}</div>
                <button onclick="this.parentElement.remove()" class="absolute -top-3 -right-3 bg-red-600 w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm shadow-md">‚úï</button>
            `;
            // ‡πÉ‡∏ä‡πâ appendChild ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ö‡∏¥‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢ (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô)
            queue.appendChild(card);
        }

        function clearOrders() { if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) document.getElementById('orderQueue').innerHTML = ""; }

        setupCamera();
    </script>
</body>
</html>
